## 浏览器

:::tip

**最后更新时间：2018年09月11日**

**字数：**

:::

**努力不一定成功，但放弃一定失败！加油**

## 学习资料

* [浏览器](https://baike.baidu.com/item/%E6%B5%8F%E8%A7%88%E5%99%A8/213911?fr=aladdin)
* [Chrome内存分析工具](https://blog.csdn.net/bug_zero/article/details/54883083)
* [JavaScript垃圾回收机制](https://www.cnblogs.com/dolphinX/p/3348468.html)

## 内存泄漏

* 内存泄漏（Memory Leak）是指程序中己动态分配的堆内存由于某种原因程序未释放或无法释放，造成系统内存的浪费，导致程序运行速度减慢甚至系统崩溃等严重后果

* 指计算机可用内存的逐渐减少，当程序持续无法释放其使用的临时内存时就会发生。
* JavaScript的web应用也会经常遇到在原生应用程序中出现的内存相关的问题，如泄漏和溢出，web应用也需要应对垃圾回收停顿

* 尽管JavaScript使用垃圾回收进行自动内存管理，但有效的(effective)内存管理依然很重要。

## JavaScript垃圾回收

* 和C#、Java一样JavaScript有自动垃圾回收机制，也就是说执行环境会负责管理代码执行过程中使用的内存，在开发过程中就无需考虑内存分配及无用内存的回收问题了
* JavaScript垃圾回收的机制：**找出不再使用的变量，然后释放掉其占用的内存，但是这个过程不是时时的，因为其开销比较大，所以垃圾回收器会按照固定的时间间隔周期性的执行。**

### 变量生命周期

* 不再使用的变量也就是生命周期结束的变量，当然只可能是局部变量，全局变量的生命周期直至浏览器卸载页面才会结束。
* 一旦函数结束，局部变量就没有存在必要了，可以释放它们占用的内存。
* 但是这样的情况往往很复杂，必须闭包，貌似函数结束了，其实没有，这种情况下就需要分析了

### 标记清除（mark and sweep)

* 当变量进入执行环境的时候，比如函数中声明一个变量，垃圾回收器将其标记为“进入环境”，当变量离开环境的时候（函数执行结束）将其标记为“离开环境”。
* 原则上讲不能够释放进入环境的变量所占的内存，它们随时可能会被调用的到。
* 垃圾回收器会在运行的时候给存储在内存中的`所有变量`加上标记，然后去掉环境中的变量以及被环境中变量所引用的变量（闭包）
* 在这些完成之后`仍存在标记的就是要删除的变量`了，因为环境中的变量已经无法访问到这些变量了，然后垃圾回收器相会这些带有标记的变量机器所占空间。

### 引用计数(reference counting)

:::tip

**小峰哥初入编程，学习ios的时候，就是学的他们的引用计数，MRC和ARC，怀念**

:::

* 在低版本IE中经常会出现内存泄露，很多时候就是因为其采用引用计数方式进行垃圾回收。
* 引用计数的策略是跟踪记录每个值被使用的次数，当声明了一个变量并将一个引用类型赋值给该变量的时候这个值的引用次数就加1
* 如果该变量的值变成了另外一个，则这个值得引用次数减1
* 当这个值的引用次数变为0的时候，说明没有变量在使用，这个值没法被访问了，因此可以将其占用的空间回收，这样垃圾回收器会在运行的时候清理掉引用次数为0的值占用的空间。

#### 引用计数缺点

* 可能会造成循环引用的问题，比如：对象A有一个属性指向对象B，而对象B也有有一个属性指向对象A，这样相互引用，就会造成内存泄露

### JavaScript垃圾回收触发

* 垃圾回收器周期性运行，如果分配的内存非常多，那么回收工作也会很艰巨
* 后期很多浏览器触发都是**动态触发**的
* 但是垃圾回收有时候是很不及时的，很多情况下效率也是很低的。

## Chrome开发工具内存分析

:::tip

**由于Chrome版本不同，会造成教程中有些不可用的问题，请大家谅解。**

**调试工具截图如下：选择Memory即可**

:::

<img src="http://bmob-cdn-4908.b0.upaiyun.com/2018/10/11/4cbc9d124014163e80420a3239ac80f5.png" />

